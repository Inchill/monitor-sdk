!function(e, t) {
    "object" == typeof exports && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define(t) : (e = "undefined" != typeof globalThis ? globalThis : e || self).WebMonitor = t();
}(this, (function() {
    "use strict";
    function e(e, t) {
        for (var n = 0; n < t.length; n++) {
            var r = t[n];
            r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), 
            Object.defineProperty(e, r.key, r);
        }
    }
    function t(e, t) {
        var r = "undefined" != typeof Symbol && e[Symbol.iterator] || e["@@iterator"];
        if (!r) {
            if (Array.isArray(e) || (r = function(e, t) {
                if (!e) {
                    return;
                }
                if ("string" == typeof e) {
                    return n(e, t);
                }
                var r = Object.prototype.toString.call(e).slice(8, -1);
                "Object" === r && e.constructor && (r = e.constructor.name);
                if ("Map" === r || "Set" === r) {
                    return Array.from(e);
                }
                if ("Arguments" === r || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)) {
                    return n(e, t);
                }
            }(e)) || t && e && "number" == typeof e.length) {
                r && (e = r);
                var o = 0, i = function() {};
                return {
                    s: i,
                    n: function() {
                        return o >= e.length ? {
                            done: !0
                        } : {
                            done: !1,
                            value: e[o++]
                        };
                    },
                    e: function(e) {
                        throw e;
                    },
                    f: i
                };
            }
            throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
        }
        var a, s = !0, f = !1;
        return {
            s: function() {
                r = r.call(e);
            },
            n: function() {
                var e = r.next();
                return s = e.done, e;
            },
            e: function(e) {
                f = !0, a = e;
            },
            f: function() {
                try {
                    s || null == r.return || r.return();
                } finally {
                    if (f) {
                        throw a;
                    }
                }
            }
        };
    }
    function n(e, t) {
        (null == t || t > e.length) && (t = e.length);
        for (var n = 0, r = new Array(t); n < t; n++) {
            r[n] = e[n];
        }
        return r;
    }
    return function() {
        function n(e) {
            !function(e, t) {
                if (!(e instanceof t)) {
                    throw new TypeError("Cannot call a class as a function");
                }
            }(this, n), this.config = Object.assign(this.normalizeConfig(), e), this.domConfig = this.normalizeDomConfig(), 
            window.$monitorConfig = this.config, this.config.jsError && this.createJsErrorMonitor();
        }
        var r, o, i;
        return r = n, (o = [ {
            key: "normalizeConfig",
            value: function() {
                return {
                    domMonitor: !1,
                    jsError: !1
                };
            }
        }, {
            key: "normalizeDomConfig",
            value: function() {
                return {
                    visibility: !0,
                    root: null,
                    threshold: .2,
                    event: !0,
                    eventListeners: [ "click" ]
                };
            }
        }, {
            key: "reportEvent",
            value: function(e, t, n) {
                var r = this.config.sendUrl, o = {
                    key: e,
                    value: t
                }, i = new Blob([ JSON.stringify(o) ], {
                    type: n || "application/x-www-form-urlencoded"
                });
                navigator.sendBeacon(r, i);
            }
        }, {
            key: "createDOMMonitor",
            value: function(e) {
                if (!1 !== this.config.domMonitor) {
                    return this.domConfig = Object.assign(this.domConfig, e), this.eventMonitor(), this.visibilityMonitor(), 
                    this;
                }
            }
        }, {
            key: "eventMonitor",
            value: function() {
                var e = this;
                if (!1 !== this.domConfig.event) {
                    var t = this.domConfig.root;
                    t && this.domConfig.eventListeners.forEach((function(n) {
                        t.addEventListener(n, (function(t) {
                            var r = t.target.getAttribute("data-click");
                            e.reportEvent(n, r);
                        }), {
                            capture: !0
                        });
                    }));
                }
            }
        }, {
            key: "visibilityMonitor",
            value: function() {
                var e = this, t = this.domConfig, n = t.root, r = t.threshold, o = new IntersectionObserver((function(t) {
                    t.forEach((function(t) {
                        var n = t.intersectionRatio, o = t.target;
                        o.hasAttribute("data-expose") && n >= r && e.reportEvent("expose", o.getAttribute("data-expose"));
                    }));
                }), {
                    root: n,
                    threshold: r
                });
                this.traverseNode(n, o);
            }
        }, {
            key: "traverseNode",
            value: function(e, n) {
                if (e) {
                    var r, o = t(e.children);
                    try {
                        for (o.s(); !(r = o.n()).done; ) {
                            var i = r.value;
                            i.hasAttribute("data-expose") && n.observe(i), i.children.length && this.traverseNode(i, n);
                        }
                    } catch (e) {
                        o.e(e);
                    } finally {
                        o.f();
                    }
                }
            }
        }, {
            key: "createJsErrorMonitor",
            value: function() {
                var e = this;
                window.addEventListener("error", (function(t) {
                    var n = t.message, r = t.type, o = t.lineno, i = t.colno, a = t.error;
                    e.reportEvent(r, {
                        message: n,
                        lineno: o,
                        colno: i,
                        stack: a.stack
                    });
                })), window.addEventListener("unhandledrejection", (function(t) {
                    e.reportEvent(t.type, {
                        reason: t.reason
                    });
                }));
            }
        } ]) && e(r.prototype, o), i && e(r, i), Object.defineProperty(r, "prototype", {
            writable: !1
        }), n;
    }();
}));
