!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).WebSniffer={})}(this,(function(e){"use strict";function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,a=function(){};return{s:a,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,f=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){f=!0,i=e},f:function(){try{c||null==n.return||n.return()}finally{if(f)throw i}}}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var o="data-event",a="data-expose",i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.domConfig=Object.assign(this.normalizeDomConfig(),t),this.onReport=n,this.domConfig.visibility&&this.visibilityWatcher(),this.domConfig.event&&this.eventWatcher()}var r,i,c;return r=e,(i=[{key:"normalizeDomConfig",value:function(){return{visibility:!1,root:document.documentElement,threshold:.2,event:!1,eventListeners:["click"]}}},{key:"eventWatcher",value:function(){var e=this,t=this.domConfig.root;t&&t instanceof HTMLElement&&this.domConfig.eventListeners.forEach((function(n){t.addEventListener(n,(function(t){var r=t.target;if(r.hasAttribute("".concat(o))){var a=r.getAttribute("".concat(o))||"",i={key:n,value:a};try{e.onReport(i)}catch(e){}}}),{capture:!0})}))}},{key:"visibilityWatcher",value:function(){var e=this,t=this.domConfig,n=t.root,r=t.threshold,o=new IntersectionObserver((function(t){t.forEach((function(t){var n=t.intersectionRatio,o=t.target;if(o.hasAttribute("".concat(a))&&n>=r){var i={key:"expose",value:o.getAttribute("".concat(a))||""};try{e.onReport(i)}catch(e){}}}))}),{root:n,threshold:r});this.traverseNode(n,o)}},{key:"traverseNode",value:function(e,t){if(e){var r,o=n(e.children);try{for(o.s();!(r=o.n()).done;){var i=r.value;i.hasAttribute("".concat(a))&&t.observe(i),i.children.length&&this.traverseNode(i,t)}}catch(e){o.e(e)}finally{o.f()}}}}])&&t(r.prototype,i),c&&t(r,c),Object.defineProperty(r,"prototype",{writable:!1}),e}();function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var u,s=[],l=!0,h=[],v=[],y=[],d=[];function m(e){var t=history[e];return function(){var n=t.apply(this,arguments),r=new Event(e);return window.dispatchEvent(r),n}}e.createDomWatcher=function(e,t){return new i(e,t)},e.createJsErrorWatcher=function(e){"function"==typeof e&&(window.addEventListener("error",(function(t){var n={type:t.type,message:t.message,filename:t.filename,lineno:t.lineno,colno:t.colno};try{e(n)}catch(e){}})),window.addEventListener("unhandledrejection",(function(t){var n={reason:t.reason};try{e(n)}catch(e){}})))},e.createResourceWatcher=function(e){var t;u=e,window.addEventListener("error",(function(e){var t=e.target;if(!(t instanceof HTMLScriptElement||t instanceof HTMLLinkElement||t instanceof HTMLImageElement||t instanceof HTMLVideoElement||t instanceof HTMLSourceElement||t instanceof HTMLAudioElement))return!1;var n=(t||HTMLImageElement||HTMLVideoElement||HTMLSourceElement||HTMLAudioElement).src||t.href;if(window.performance)s.forEach((function(e){if(e.name===n){var t={tagName:e.initiatorType,url:n};try{u(t)}catch(e){}}})),s=[];else if(l)h.push(e);else{var r={tagName:e.target.tagName.toLowerCase(),url:n};try{u(r)}catch(e){}}}),{capture:!0}),window.performance?(t=performance.getEntriesByType("resource"),s=t.filter((function(e){return"beacon"!==e.initiatorType})),performance.clearResourceTimings(),new PerformanceObserver((function(e){var t=e.getEntries();s=t.filter((function(e){return"beacon"!==e.initiatorType}))})).observe({entryTypes:["resource"]})):document.onreadystatechange=function(e){if("complete"===document.readyState){var t,n=e.target,r=n.styleSheets,o=n.scripts,a=n.images,i=c(r);try{for(i.s();!(t=i.n()).done;){var f=t.value;f.href&&v.push(f)}}catch(e){i.e(e)}finally{i.f()}var s,m=c(o);try{for(m.s();!(s=m.n()).done;){var p=s.value;p.src&&y.push(p)}}catch(e){m.e(e)}finally{m.f()}var g,b=c(a);try{for(b.s();!(g=b.n()).done;){var w=g.value;w.src&&d.push(w)}}catch(e){b.e(e)}finally{b.f()}h.forEach((function(e){var t=e.target,n=(t||HTMLImageElement).src||t.href;!function(e,t,n){e instanceof HTMLLinkElement&&v.forEach((function(t){if(t.href===n){var r={tagName:e.tagName.toLowerCase(),url:n};try{u(r)}catch(e){}}})),e instanceof HTMLScriptElement&&y.forEach((function(t){if(t.src===n){var r={tagName:e.tagName.toLowerCase(),url:n};try{u(r)}catch(e){}}})),e instanceof HTMLImageElement&&d.forEach((function(t){if(t.src===n){var r={tagName:e.tagName.toLowerCase(),url:n};try{u(r)}catch(e){}}}))}(e.target,e.type,n)})),l=!1}}},e.createRouteWatcher=function(e){window.onhashchange=function(t){var n=t.oldURL,r=t.newURL;e({oldURL:n,newURL:r})},function(e,t){e.forEach((function(e){window.addEventListener(e,(function(e){var n=e.target.location,r=n.href,o=n.origin;t({newURL:r,oldURL:o})}))}))}(["pushState","replaceState"],e),window.history.pushState=m("pushState"),window.history.replaceState=m("replaceState")}}));
